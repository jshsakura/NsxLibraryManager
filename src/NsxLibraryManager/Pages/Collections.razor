@page "/collections"
@using NsxLibraryManager.Shared.Dto
@using NsxLibraryManager.Services
@inject AppLocalizer Localizer

<PageTitle>@Localizer["Collections"]</PageTitle>
<RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Normal" Wrap="FlexWrap.NoWrap" Gap="1rem">
    <RadzenDataGrid
        @ref="_grid"
        TItem="CollectionDto"
        Data="@_collections"
        EditMode="DataGridEditMode.Single"
        ShowEmptyMessage="false"
        RowUpdate="@OnUpdateRow" 
        RowCreate="@OnCreateRow" 
        PageSize="@_pageSize"
        PageSizeOptions="@_pageSizeOptions"
        PageSizeChanged="@(args => _pageSize = args)"
        Count="@_count"
        IsLoading="@_isLoading"
        AllowAlternatingRows="false"
        AllowSorting="true"
        AllowPaging="true"
        AllowFiltering="true"
        FilterMode="FilterMode.SimpleWithMenu"
        FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
        AllowColumnResize="true"
        PagerHorizontalAlign="HorizontalAlign.Center"
        ColumnWidth="200px" AllowColumnPicking="true"
        ShowPagingSummary="true"
        >
        <HeaderTemplate>
            <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle" Text="@Localizer["AddNewCollection"]" Click="@InsertRow" Disabled="@_newRecordInsertDisabled"/>
        </HeaderTemplate>
        <Columns>
            <RadzenDataGridColumn Property="Id" Title="@Localizer["CollectionID"]" Width="90px" Frozen="true" />
            <RadzenDataGridColumn Property="Name" Title="@Localizer["Collection"]" Width="280px" SortOrder="SortOrder.Ascending">
                <EditTemplate Context="collection">
                    <RadzenTextBox @bind-Value="collection.Name"  Style="width:100%; display: block" Name="Name" aria-label="@Localizer["EnterName"]" />
                    <RadzenRequiredValidator Text="@Localizer["NameIsRequired"]" Component="Name" Popup="true" />
                </EditTemplate>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn Property="TitlesCount" Title="@Localizer["TitlesInCollection"]" Width="150px" />
            <RadzenDataGridColumn Property="BaseTitlesCount" Title="@Localizer["BaseTitles"]" Width="150px" />
            <RadzenDataGridColumn Property="DlcTitlesCount" Title="@Localizer["DLCTitles"]" Width="150px" />
            <RadzenDataGridColumn Property="UpdatesTitlesCount" Title="@Localizer["UpdateTitles"]" Width="150px" />

            <RadzenDataGridColumn Context="collection" Filterable="false" Sortable="false" TextAlign="TextAlign.Right" Frozen="true" FrozenPosition="FrozenColumnPosition.Right">
                <Template Context="collection">
                    <RadzenButton Icon="add_circle" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium" Shade="Shade.Lighter" Click="@(() => InsertAfterRow(collection))" title="@Localizer["AddNewRowAfterThisRow"]"  Disabled="@_newRecordInsertDisabled"/>
                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" class="rz-my-1 rz-ms-1" Click="@(args => EditRow(collection))" @onclick:stopPropagation="true" />
                    <RadzenButton Icon="delete" ButtonStyle="ButtonStyle.Danger" Variant="Variant.Flat" Size="ButtonSize.Medium" Shade="Shade.Lighter" class="rz-my-1 rz-ms-1" Click="@(args => DeleteRow(collection))" @onclick:stopPropagation="true" />
                </Template>
                <EditTemplate Context="collection">
                    <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@((args) => SaveRow(collection))" aria-label="@Localizer["Save"]"/>
                    <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" class="rz-my-1 rz-ms-1" Click="@((args) => CancelEdit(collection))" aria-label="@Localizer["Cancel"]"/>
                    <RadzenButton Icon="delete" ButtonStyle="ButtonStyle.Danger" Variant="Variant.Flat" Size="ButtonSize.Medium" Shade="Shade.Lighter" class="rz-my-1 rz-ms-1" Click="@(args => DeleteRow(collection))" aria-label="@Localizer["Delete"]" />
                </EditTemplate>
            </RadzenDataGridColumn>
        </Columns>
    </RadzenDataGrid>
</RadzenStack>