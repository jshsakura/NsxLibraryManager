@page "/CollectionRenamer"
@using NsxLibraryManager.Core.Models
@using NsxLibraryManager.Shared.Dto
@using NsxLibraryManager.Shared.Enums
@using Microsoft.Extensions.Localization
@using NsxLibraryManager.Resources
@inject IStringLocalizer<SharedResource> Localizer

<PageTitle>@Localizer["CollectionRenamer"]</PageTitle>

<RadzenTabs @bind-SelectedIndex="@selectedTabIndex" Change="@OnChangeTab">
    <Tabs>
        <RadzenTabsItem Text="@Localizer["Renamer"]">
            <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Wrap="FlexWrap.Wrap" Gap="1rem">
                <RadzenDataGrid @ref="_renameGrid" Data="@_renameTitles" TItem="RenameTitleDto" AllowSorting="true" AllowPaging="true" PageSize="100"
                                AllowFiltering="true" FilterMode="FilterMode.SimpleWithMenu" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive"
                                AllowColumnResize="true" PagerHorizontalAlign="HorizontalAlign.Center" ColumnWidth="200px" AllowColumnPicking="true"
                                IsLoading="@isLoading" AllowColumnReorder="true" PageSizeOptions="@_pageSizeOptions" ShowPagingSummary="true" style="height: 95vh">
                    <HeaderTemplate>
                        <RadzenButton Text="@Localizer["ScanLibraryTitles"]" Click="@LoadFiles" ButtonStyle="ButtonStyle.Primary" Disabled="@_scanInputButtonDisabled" class=".rz-shadow-2"/>
                        <RadzenButton Text="@Localizer["RenameFiles"]" Click="@RenameFiles" ButtonStyle="ButtonStyle.Danger" Disabled="@_renameButtonDisabled" class=".rz-shadow-2"/>
                        <RadzenText TextStyle="TextStyle.Caption">@Localizer["InputPathLabel"] @_inputPathDisplay</RadzenText> |
                        <RadzenText TextStyle="TextStyle.Caption">@Localizer["OutputPathLabel"] @_outputPathDisplay </RadzenText>
                    </HeaderTemplate>
                    <Columns>
                        <RadzenDataGridColumn Property="SourceFileName" Title="@Localizer["SourceFile"]" Width="200px">
                            <Template Context="renameTitle">
                                <p style="white-space:pre-wrap">@renameTitle.SourceFileName</p>
                            </Template>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Property="DestinationFileName" Title="@Localizer["Destination"]" Width="200px">
                            <Template Context="renameTitle">
                                <p style="white-space:pre-wrap">@renameTitle.DestinationFileName</p>
                            </Template>
                        </RadzenDataGridColumn>
                        <RadzenDataGridColumn Property="TitleId" Title="@Localizer["TitleId"]" Width="100px"/>
                        <RadzenDataGridColumn Property="TitleName" Title="@Localizer["Name"]" Width="100px"/>
                        <RadzenDataGridColumn Property="Error" Title="@Localizer["Error"]" Width="50px"/>
                        <RadzenDataGridColumn Property="ErrorMessage" Title="@Localizer["ErrorMessage"]" Width="200px">
                            <Template Context="renameTitle">
                                <p style="white-space:pre-wrap">@renameTitle.ErrorMessage</p>
                            </Template>
                        </RadzenDataGridColumn>

                    </Columns>
                </RadzenDataGrid>
            </RadzenStack>
        </RadzenTabsItem>
        <RadzenTabsItem Text="@Localizer["Configuration"]">
            <RadzenStack Style="padding-bottom: .5rem ">
                <RenamerFieldSet Text="@Localizer["FileOrganizerByCollection"]" AllowCollapse="false" Visible="true">
                    <RadzenRow Gap="1rem">
                        <RadzenColumn Size="12" SizeSM="6">
                            <RenamerFieldSet Text="@Localizer["Input"]">
                                <RadzenFormField Text="@Localizer["InputPathLibraryPath"]" Variant="@Variant" Style="width: 100%; padding: 1px">
                                    <ChildContent>
                                        <RadzenDropDown @bind-Value="@_settings.InputPath" Data="@_libraryLocations" TextProperty="Path" ValueProperty="Path" Style="width: 100%;" Name="DropDownInputPath" />

                                    </ChildContent>
                                    <Helper>
                                        <div class="rz-message rz-messages-error ">@_validationErrors["InputPath"]</div>
                                    </Helper>
                                </RadzenFormField>
                                <RadzenFormField Text="@Localizer["UnknownPlaceholder"]" Variant="@Variant" Style="width: 100%; padding: 1px">
                                    <ChildContent>
                                        <RadzenTextBox @bind-Value="@_settings.UnknownPlaceholder" id="UnknownPlaceholder" Name="UnknownPlaceholder"
                                                       Style="font-family: monospace;"
                                        />
                                    </ChildContent>
                                    <Helper>
                                        <RadzenText TextStyle="TextStyle.Caption">@Localizer["UnknownPlaceholderDescription"]</RadzenText>
                                        
                                    </Helper>
                                </RadzenFormField>
                                <RadzenRow class="rz-text-align-center">
                                    <RadzenColumn Size="6">
                                        <RadzenCheckBox Name="DeleteEmptyFolders" 
                                                        @bind-Value="@_settings.DeleteEmptyFolders" 
                                                        MouseEnter="@(args => ShowTooltip("Once the rename process finishes, all empty folders inside input path will be removed.", args) )"/>
                                        <RadzenLabel Text="@Localizer["DeleteEmptyFoldersAfterRename"]" Component="DeleteEmptyFolders" Style="margin-left: 8px; vertical-align: middle;"/>
                                    </RadzenColumn>
                                    <RadzenColumn Size="6">
                                        <RadzenCheckBox Name="Recusive" @bind-Value="@_settings.Recursive"/>
                                        <RadzenLabel Text="@Localizer["RecursiveSubdirectories"]" Component="Recusive" Style="margin-left: 8px; vertical-align: middle;"/>
                                    </RadzenColumn>
                                </RadzenRow>
                            </RenamerFieldSet>
                            <RenamerFieldSet Text="@Localizer["Output"]">
                                <RadzenFormField Text="@Localizer["BasePathLibraryPath"]" Variant="@Variant" Style="width: 100%; padding: 1px">
                                    <ChildContent>
                                        <RadzenDropDown @bind-Value="@_settings.OutputBasePath" Data="@_libraryLocations" TextProperty="Path" ValueProperty="Path" Style="width: 100%;" Name="DropDownOutputPath" />

                                    </ChildContent>
                                    <Helper>
                                        <div class="rz-message rz-messages-error ">@_validationErrors["OutputBasePath"]</div>
                                    </Helper>
                                </RadzenFormField>
                                <RadzenFormField Text="@Localizer["Application"]" Variant="@Variant" Style="width: 100%; padding: 1px">
                                    <RadzenTextBox @bind-Value="@_templateFields[TitlePackageType.BundleBase].Value" id="BundleBase" Name="BundleBase"
                                                   Style="font-family: monospace;"
                                                   @oninput="@(args => OnTemplateFieldInput(TitlePackageType.BundleBase, args.Value?.ToString()))"
                                                   @onclick="@(args => OnTemplateFieldClick(TitlePackageType.BundleBase, args))"
                                    />
                                </RadzenFormField>
                                <RadzenFormField Text="@Localizer["Update"]" Variant="@Variant" Style="width: 100%; padding: 1px">
                                    <RadzenTextBox @bind-Value="@_templateFields[TitlePackageType.BundleUpdate].Value" id="BundleUpdate" Name="BundleUpdate"
                                                   Style="font-family: monospace;"
                                                   @oninput="@(args => OnTemplateFieldInput(TitlePackageType.BundleUpdate, args.Value?.ToString()))"
                                                   @onclick="@(args => OnTemplateFieldClick(TitlePackageType.BundleUpdate, args))"
                                    />
                                </RadzenFormField>
                                <RadzenFormField Text="@Localizer["DLCs"]" Variant="@Variant" Style="width: 100%; padding: 1px">
                                    <RadzenTextBox @bind-Value="@_templateFields[TitlePackageType.BundleDlc].Value" id="BundleDlc" Name="BundleDlc"
                                                   Style="font-family: monospace;"
                                                   @oninput="@(args => OnTemplateFieldInput(TitlePackageType.BundleDlc, args.Value?.ToString()))"
                                                   @onclick="@(args => OnTemplateFieldClick(TitlePackageType.BundleDlc, args))"
                                    />
                                </RadzenFormField>
                                <RadzenRow class="rz-text-align-center">
                                    <RadzenColumn Size="6">
                                        <RadzenCheckBox Name="UseEnglishNaming"
                                                        @bind-Value="@_settings.UseEnglishNaming"
                                                        MouseEnter="@(args => ShowTooltip("For titles in Asia regions (JP, CN, KO, HK) prefer Nswdb for title name", args) )"/>
                                        <RadzenLabel Text="@Localizer["TryToUseEnglishNaming"]" Component="UseEnglishNaming" Style="margin-left: 8px; vertical-align: middle;"/>
                                    </RadzenColumn>
                                    <RadzenColumn Size="6">
                                        <RadzenCheckBox Name="TitlesForceUppercase"
                                                        @bind-Value="@_settings.TitlesForceUppercase"
                                                        MouseEnter="@(args => ShowTooltip("Convert TitleName and AppName to Title Case when renaming.", args) )"/>
                                        <RadzenLabel Text="@Localizer["TitleNameAndAppNameToTitleCase"]"
                                                     Component="TitlesForceUppercase"
                                                     Style="margin-left: 8px; vertical-align: middle;"/>
                                    </RadzenColumn>
                                </RadzenRow>
                            </RenamerFieldSet>
                            <RadzenRow Style="margin-top: .5rem;" JustifyContent="JustifyContent.Center">
                                <RadzenButton Variant="Variant.Outlined" ButtonStyle="ButtonStyle.Light" Click="@LoadDefaultTemplate" class="rz-ripple">@Localizer["DefaultConfiguration"]</RadzenButton>
                                <RadzenButton Variant="Variant.Outlined" ButtonStyle="ButtonStyle.Success" Click="@ValidateConfiguration" class="rz-ripple">@Localizer["ValidateConfiguration"]</RadzenButton>
                                <RadzenButton Variant="Variant.Outlined" Click="@SaveConfiguration" class="rz-ripple">@Localizer["SaveConfiguration"]</RadzenButton>
                            </RadzenRow>
                        </RadzenColumn>
                        <RadzenColumn Size="12" SizeSM="6">
                            <RenamerFieldSet Text="@Localizer["TemplateFields"]">
                                <RadzenRow Gap="0.1rem" Style="padding-bottom: .1rem">
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.CollectionName]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.CollectionName, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.CollectionName, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.TitleName]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.TitleName, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.TitleName, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.TitleId]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.TitleId, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.TitleId, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.Version]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.Version, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.Version, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.Region]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.Region, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.Region, args))"
                                                      ButtonStyle="ButtonStyle.Info" Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                </RadzenRow>
                                <RadzenRow Gap="0.1rem">
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.Size]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.Size, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.Size, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.Extension]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.Extension, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.Extension, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.AppName]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.AppName, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.AppName, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>

                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.DlcCount]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.DlcCount, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.DlcCount, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                    <RadzenColumn class="rz-p-2" Style="text-align: center; padding: 0 !important;">
                                        <RadzenButton Text="@_templateFieldMappings[TemplateField.PatchCount]" Shade="Shade.Lighter" Disabled="@_fragmentButtonDisabled"
                                                      Click="@(args => TemplateFragmentClick(TemplateField.PatchCount, args))"
                                                      MouseEnter="@(args => ShowTooltip(TemplateField.PatchCount, args))"
                                                      ButtonStyle="ButtonStyle.Info"
                                                      Style="width: 100%; height: 100%;"/>
                                    </RadzenColumn>
                                </RadzenRow>
                            </RenamerFieldSet>
                            <RenamerFieldSet Text="@_sampleResultLabel">
                                <RadzenRow Gap="0.1rem">
                                    <RadzenColumn Size="1">@Localizer["Before"]</RadzenColumn>
                                    <RadzenColumn Size="11">
                                        <RadzenText Style="font-family: monospace; font-size: .7rem" Text="@_sampleBefore"/>
                                    </RadzenColumn>
                                </RadzenRow>
                                <RadzenRow Gap="0.1rem">
                                    <RadzenColumn Size="1">@Localizer["After"]</RadzenColumn>
                                    <RadzenColumn Size="11">
                                        <RadzenText Style="font-family: monospace; font-size: .7rem" Text="@_sampleAfter"/>
                                    </RadzenColumn>
                                </RadzenRow>
                            </RenamerFieldSet>
                        </RadzenColumn>
                    </RadzenRow>
                </RenamerFieldSet>

            </RadzenStack>
        </RadzenTabsItem>
    </Tabs>
</RadzenTabs>